import json


idx = {
    0: 0,
    1: 1,
    2: 3,
    3: 5,
    4: 6,
    5: 8,
    6: 10,
    7: 12
}


base = 4
melody = "1,0.25  1,0.25  \
    1,0.25  1,0.25  1,0.25  1,0.25  1,0.5  1,0.25  6_,0.75  1,0.5  0,0.75  1,0.25 \
    5_,0.25  5_,0.25  5_,0.25  5_,0.25  2,0.5  7_,0.25  1,0.75  5_,0.5  0,0.5  5_,0.25  1,0.25 \
    1,0.25  1,0.5  1,0.25  3,0.5  1,0.25  1,0.75  6_,0.5  0,0.5  6_,0.5 \
    5_,0.25  5_,0.25  5_,0.25  5_,0.25  2,0.5  7_,0.25  1,1.25  3_,0.5  4_,0.5 \
    5_,1  1,1  7_,0.5  7_,0.5  6_,0.5  6_,0.25  6_,0.75  \
    5_,0.5  2_,0.5  4_,0.25  4_,0.75  3_,0.5  0,0.5  1_,1  \
    1_,0.5  6_,0.5  7_,0.25  6_,0.75  5_,0.5  0,0.5  3_,0.5  \
    4_,0.5  5_,0.5  6_,0.5  7_,0.25  6_,0.75  5_,0.5  0,1  \
    5_,1  1,0.5  1,0.25  1,0.75  6_,0.5  0,0.5  6_,0.5  \
    5_,0.5  2,0.5  2,0.5  7_,0.25  1,0.75  3,0.5  0,0.5  4,1  \
    4,0.5  3,0.5  3,0.5  1,0.5  6_,0.5  7_,0.5  1,0.25  2,2.25 \
    1,0.5  1,0.5  2,0.5  3,0.5  3,0.5  5,0.5  5,0.25  5,0.75  4,0.5  0,0.5 \
    1,0.5  2,0.5  2,0.5  4,0.5  5,0.25  4,0.75  3,0.5  0,1  \
    1,0.5  1,0.5  3,0.5  4,0.25  3,0.75  2,0.5  6_,0.5  7_,0.5 \
    1,1  3,0.5  4,0.25  3,0.75  2,0.5  0,0.5  5_,0.5  \
    3,1.25  5,0.25  5,0.25   5,0.5   4,0.5  0,0.5  1,0.5  \
    2,0.5  2,0.5  4,0.5  5,0.25  4,0.75  3,0.5  0,0.5  1,0.5  \
    1,0.5  6,0.5  0,0.5  1,0.5  7_,0.5  3,0.5  3,0.25  3,0.75  \
    1,0.5  0,0.5  2,0.25  1,0.75  "
melody_li = melody.split()
song = []

# base = [110, 220, 440, 880]

for mel in melody_li:
    tune_beat = mel.split(',')
    beat = float(tune_beat[1])
    t = idx[int(tune_beat[0][0])]
    if t != 0:
        idx_0 = (t + base - 1) % 12 + 1
        if len(tune_beat[0]) == 1:
            idx_1 = 3
        elif tune_beat[0][1] == '^':
            idx_1 = 4
        elif tune_beat[0][1] == '_':
            idx_1 = 2
        else: 
            idx_1 = 3
        idx_1 += (t + base - 1) // 12
    else:
        idx_0 = 0
        idx_1 = 0
    song.append([idx_1, idx_0, beat])

json_song = {'song': song}
with open("test.json", "w") as f:
    _ = json.dump(json_song, f)